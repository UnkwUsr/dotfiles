#!/bin/bash

shopt -s extglob
case $1 in
    default)
        NEW_VOL="100"
        ;;
    file)
        NEW_VOL=$(cat ~/.dbvolume_level)
        ;;
    +*)
        ;&
    -*)
        OPER=$(echo $1 | head -c 1)
        NUM=$(echo $1 | tail -c +2)
        PREV_VOL=$(cat ~/.dbvolume_level)
        NEW_VOL=$(echo $PREV_VOL $OPER $NUM | bc)

        echo $NEW_VOL > ~/.dbvolume_level
        ;;
    +([0-9]))
        NEW_VOL=$1

        echo $NEW_VOL > ~/.dbvolume_level
        ;;
    *)
        echo "Example: dbvolume [+/-]200"
        exit 1
        ;;
esac

if [ -n "$NEW_VOL" ]; then
    NEW_VOL=$NEW_VOL%

    pactl list sink-inputs short | awk '{print $1}' | while :
    do
        read id
        [ -z "${id}" ] && exit 0

        echo set $NEW_VOL volume for id $id
        pactl set-sink-input-volume $id $NEW_VOL
    done
fi
