#!/bin/bash

echo "Stopping clipboard history"
SAVED_CLIP=$(greenclip print | head -n 1)
pkill greenclip --signal=STOP

dstatus set "*waiting for response from lpass*"
lpass ls --format=%an | dmenu -l 10 | xargs -I '{}' lpass show {} | tail -n +2 | dmenu -l 2 | awk '{print $2}' | xclip -selection clipboard
dstatus set "*waiting for response from lpass show*"

echo "Password stored in clipboard. Use your password and stop dstatus to continue clipboard history"
dstatus set "*waiting for password has been used*"
dstatus wait

echo "Resuming clipboard history"
echo "$SAVED_CLIP" | xclip -selection clipboard
pkill greenclip --signal=CONT
